package player

import "net/http"
import "fmt"

import "goodbuzz/lib"


func Get(w http.ResponseWriter, r *http.Request) {
    roomId :=  r.PathValue("id")
    room := lib.GetRoom(roomId)

    if room == nil {
      http.NotFound(w, r)
      return
    }

    content := index(room)
    lib.Render(w, r, content)
}

templ index(room *lib.Room) {
<title>Buzzer Room</title>

<h1>Room #{fmt.Sprintf("%d", room.Id())}</h1>

@BuzzerButton(room.Status() != lib.Unlocked)

<section class="log" hx-ext="sse" sse-connect="./player/live" sse-swap="log" hx-swap="beforeend">
</section>

<script>
function buzz() {
  const button = document.querySelector('.buzzer')
  fetch(`./buzz`, { method: 'PUT' })

  button.setAttribute('disabled', 'true')
  button.innerText = 'Waiting...'
}
</script>
}

templ BuzzerButton (isDisabled bool) {
  <button
    class="buzzer"
    id="buzzer"
    onclick="buzz()"
    hx-swap-oob="outerHTML:.buzzer"
    disabled?={isDisabled}
    >Buzz
    </button>
}
