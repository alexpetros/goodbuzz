package player

import "net/http"

import "goodbuzz/lib"
import "goodbuzz/router/rooms"


func Get(w http.ResponseWriter, r *http.Request) {
    param :=  r.PathValue("id")
    room := rooms.GetRoom(r.Context(), param)

    if room == nil {
      http.NotFound(w, r)
      return
    }

    content := index(room)
    lib.Render(w, r, room.Name(), content)
}

templ index(room *rooms.Room) {
<h1>{room.Name()}</h1>

@rooms.BuzzerButton(room.Status() != rooms.Unlocked)

<section class="log" hx-ext="sse" sse-connect="./player/live" sse-swap="log" hx-swap="beforeend">
</section>

<script>
function buzz() {
  const button = document.querySelector('.buzzer')
  fetch(`./buzz`, { method: 'PUT' })

  button.setAttribute('disabled', 'true')
  button.innerText = 'Waiting...'
}
</script>
}
